<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>01-hierarchy - Java Core</title>
  <link rel="icon" type="image/svg+xml" href="../../favicon.svg">
  <link rel="stylesheet" href="../../css/style.css">
  <style>.flow-diagram svg g.node,.flow-diagram svg rect,.flow-diagram svg path{pointer-events:auto !important}.flow-tooltip{position:fixed;z-index:9999;max-width:380px;padding:1rem 1.25rem;background:#fff;border:1px solid #10B981;border-radius:10px;box-shadow:0 12px 32px rgba(0,0,0,.15);font-size:.9rem;line-height:1.6;pointer-events:none;opacity:0;visibility:hidden;transition:opacity .2s,visibility .2s}.flow-tooltip.is-visible{opacity:1;visibility:visible}.flow-tooltip__title{font-weight:600;margin-bottom:.6rem;color:#059669}.flow-tooltip__body{color:#475569}</style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="topic-page">
  <header class="topic-header">
    <div class="topic-header-inner">
      <a href="../../index.html" class="topic-header-logo">Java Core</a>
      <nav class="topic-header-nav">
        <a href="../../index.html">Trang chủ</a>
      </nav>
    </div>
  </header>
  <div class="topic-layout">
    <nav class="topic-sidebar"><ul>
        <li><a href="../../index.html">Trang ch&#7911;</a>
        </li>
        <li><a href="../oop/01-intro.html">OOP</a>
        </li>
        <li><a href="../collections/01-intro.html">Collections</a>
        </li>
        <li><a href="../io-nio/01-intro.html">I/O & NIO</a>
        </li>
        <li><a href="../concurrency/01-intro.html">Concurrency</a>
        </li>
        <li><a href="../jvm-memory/01-architecture.html">JVM & Memory</a>
        </li>
        <li><a href="../exception/01-hierarchy.html" class="topic-sidebar-link--active">Exception</a>
        <ul class="topic-sub-nav">
          <li><a href="../exception/01-hierarchy.html" class="topic-sidebar-link--active">01-hierarchy</a></li>
          <li><a href="../exception/02-keywords.html">Keywords</a></li>
          <li><a href="../exception/03-try-with-resources.html">Try-with-resources</a></li>
          <li><a href="../exception/04-propagation.html">Propagation</a></li>
          <li><a href="../exception/05-jvm-cost.html">JVM Cost</a></li>
          <li><a href="../exception/06-best-practices.html">Best Practices</a></li>
        </ul>
        </li>
        <li><a href="../generics/01-intro.html">Generics</a>
        </li>
        <li><a href="../lambda/01-intro.html">Lambda & Stream</a>
        </li>
</ul></nav>

    <main class="main-content topic-main">
      <div class="breadcrumb"><a href="../../index.html">Trang ch&#7911;</a> / <a href="../exception/01-hierarchy.html">Exception</a> / 01-hierarchy</div>
      <article class="topic-content">
        <h2>Exception — Xử lý ngoại lệ</h2>

<p>Exception Handling là quản lý luồng điều khiển (control flow) để ứng dụng không "sập" bất ngờ và cung cấp đủ thông tin để truy vết lỗi trong Production. Mọi lỗi trong Java bắt nguồn từ <code>java.lang.Throwable</code>.</p>

<section>
  <h3>Tổng quan từng phần</h3>
  <p>Mỗi phần gồm: <strong>Kỹ thuật</strong> (định nghĩa, cú pháp, quy tắc) và <strong>Ví dụ</strong> (code minh họa).</p>
  <table class="comparison-table">
    <caption>Exception — Kỹ thuật và Ví dụ</caption>
    <thead>
      <tr>
        <th>Phần</th>
        <th>Kỹ thuật</th>
        <th>Ví dụ</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>01 — Hierarchy</strong></td>
        <td>Throwable, Error, Checked vs Unchecked</td>
        <td>Sơ đồ phân cấp, throws IOException, IllegalArgumentException</td>
      </tr>
      <tr>
        <td><strong>02 — Keywords</strong></td>
        <td>try-catch-finally, throw, throws</td>
        <td>Multi-catch, rethrow, finally cleanup</td>
      </tr>
      <tr>
        <td><strong>03 — Try-with-resources</strong></td>
        <td>AutoCloseable, ARM, suppressed</td>
        <td>try (InputStream in = ...)</td>
      </tr>
      <tr>
        <td><strong>04 — Propagation</strong></td>
        <td>Lan truyền exception, stack trace</td>
        <td>method1 → method2 → method3</td>
      </tr>
      <tr>
        <td><strong>05 — JVM Cost</strong></td>
        <td>Chi phí throw, fillInStackTrace</td>
        <td>So sánh performance</td>
      </tr>
      <tr>
        <td><strong>06 — Best Practices</strong></td>
        <td>Khi catch, khi throw, logging</td>
        <td>Early return, specific catch</td>
      </tr>
    </tbody>
  </table>
</section>

<section>
  <h3>Lộ trình học — Sơ đồ flow</h3>
  <p>Sơ đồ dưới đây thể hiện thứ tự học và mối liên hệ giữa các phần. Mỗi ô là một phần; mũi tên chỉ hướng tiếp theo.</p>

  <div class="flow-diagram">
    <script type="application/json" data-flow-tooltips>
    {"C1":{"title":"01 Hierarchy","detail":"<p><strong>Throwable</strong> là gốc. Hai nhánh: Error (lỗi hệ thống, không nên catch) và Exception (có thể xử lý).</p><p><strong>Error:</strong> OutOfMemoryError, StackOverflowError - JVM gặp vấn đề nghiêm trọng. Để chương trình thoát.</p><p><strong>Checked:</strong> IOException, SQLException - compiler bắt try-catch hoặc throws.</p><p><strong>Unchecked (RuntimeException):</strong> NullPointerException, IllegalArgumentException - thường do bug, không bắt buộc khai báo.</p>"},"C2":{"title":"02 Keywords","detail":"<p><strong>try-catch</strong> - bắt exception. Catch cụ thể trước, chung sau. Multi-catch: catch (A | B e).</p><p><strong>finally</strong> - luôn chạy (trừ System.exit). Dùng cleanup. Lưu ý: không return trong finally.</p><p><strong>throw</strong> - ném exception. throws - khai báo method có thể ném.</p>"},"C3":{"title":"03 Try-with-resources","detail":"<p><strong>AutoCloseable</strong> - interface với close(). try (Resource r = ...) tự gọi close() khi thoát block.</p><p>Không cần finally close. Suppressed exceptions - nếu cả try và close đều throw, close exception bị suppressed, có thể lấy qua getSuppressed().</p>"},"C4":{"title":"04 Propagation","detail":"<p>Exception lan truyền lên caller nếu không bắt. Mỗi method pop khỏi stack khi throw.</p><p><strong>Stack trace</strong> - đọc từ dưới lên: nơi throw trước, caller sau. Giúp debug nhanh.</p>"},"C5":{"title":"05 JVM Cost","detail":"<p><strong>fillInStackTrace()</strong> - tốn chi phí vì phải walk stack. Throw nhiều lần trong vòng lặp có thể chậm.</p><p>Tránh dùng exception cho control flow. Dùng khi thực sự exceptional.</p>"},"C6":{"title":"06 Best Practices","detail":"<p>Catch cụ thể (IOException) thay vì Exception. Early return sau khi xử lý. Log đầy đủ với stack trace.</p><p>Không catch rồi bỏ trống. Wrap exception khi cần (cause).</p>"}}
    </script>
    <pre class="mermaid">
flowchart TD
  subgraph Foundation [Foundation]
    direction LR
    C1("01 Hierarchy")
    C2("02 Keywords")
    C1 -->|"Error, Checked, Unchecked"| C2
  end
  subgraph Resources [Resources]
    C3("03 Try-with-resources")
  end
  subgraph Deep [Deep Dive]
    direction LR
    C4("04 Propagation")
    C5("05 JVM Cost")
    C6("06 Best Practices")
    C4 -->|"Stack trace"| C5 -->|"Catch cụ thể"| C6
  end
  Foundation -->|"try-catch-finally"| Resources
  Resources -->|"AutoCloseable"| Deep
    </pre>
  </div>

  <table class="comparison-table">
    <caption>Chú thích từng phần</caption>
    <thead>
      <tr><th>Phần</th><th>Nội dung chính</th></tr>
    </thead>
    <tbody>
      <tr><td>01</td><td>Throwable, Error, Checked vs Unchecked</td></tr>
      <tr><td>02</td><td>try-catch-finally, throw, throws, multi-catch</td></tr>
      <tr><td>03</td><td>try (InputStream in = ...), suppressed</td></tr>
      <tr><td>04</td><td>Lan truyền exception, đọc stack trace</td></tr>
      <tr><td>05</td><td>Chi phí throw, fillInStackTrace</td></tr>
      <tr><td>06</td><td>Specific catch, early return, logging</td></tr>
    </tbody>
  </table>
</section>

<section>
  <h3>Hệ thống phân cấp Throwable</h3>

  <h4>Kỹ thuật — Sơ đồ phân cấp</h4>
  <pre><code>Throwable
├── Error (không nên catch)
│   ├── OutOfMemoryError
│   ├── StackOverflowError
│   └── VirtualMachineError
└── Exception
    ├── RuntimeException (Unchecked)
    │   ├── NullPointerException
    │   ├── IllegalArgumentException
    │   ├── ArrayIndexOutOfBoundsException
    │   └── ...
    └── IOException, SQLException... (Checked)</code></pre>

  <h4>Error</h4>
  <p>Lỗi hệ thống nghiêm trọng mà ứng dụng không nên (và thường không thể) xử lý. Ví dụ: <code>OutOfMemoryError</code>, <code>StackOverflowError</code>, <code>VirtualMachineError</code>. Khi gặp, tốt nhất để chương trình dừng — không nên catch.</p>

  <h4>Exception</h4>
  <p>Tình huống lỗi mà chương trình có thể dự đoán và xử lý. Chia hai nhánh:</p>
  <ul>
    <li><strong>Checked Exception:</strong> Bắt buộc xử lý tại compile-time. Kế thừa <code>Exception</code> (không phải RuntimeException). Ví dụ: <code>IOException</code>, <code>SQLException</code>, <code>ClassNotFoundException</code>. Compiler bắt buộc try-catch hoặc <code>throws</code>.</li>
    <li><strong>Unchecked Exception (Runtime):</strong> Xảy ra khi chạy. Kế thừa <code>RuntimeException</code>. Thường do lỗi logic. Ví dụ: <code>NullPointerException</code>, <code>ArrayIndexOutOfBoundsException</code>, <code>IllegalArgumentException</code>. Không bắt buộc khai báo.</li>
  </ul>

  <h4>Khi nào dùng Checked vs Unchecked?</h4>
  <p><strong>Checked:</strong> Lỗi recoverable — caller có thể xử lý (retry, fallback). Ví dụ: file không tìm thấy, network timeout. <strong>Unchecked:</strong> Lỗi programming — bug, validation fail. Caller thường không thể recover. Ví dụ: null pointer, invalid argument.</p>
  <h4>Ví dụ</h4>
  <pre><code>// Checked — caller phải xử lý
public void readFile() throws IOException {
  Files.readAllBytes(path);
}

// Unchecked — không bắt buộc khai báo
public void setAge(int age) {
  if (age &lt; 0 || age > 150) {
    throw new IllegalArgumentException("Invalid age: " + age);
  }
}</code></pre>

  <table class="comparison-table">
    <caption>Error vs Checked vs Unchecked</caption>
    <thead>
      <tr>
        <th>Loại</th>
        <th>Compile-time</th>
        <th>Ví dụ</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Error</td>
        <td>Không bắt buộc</td>
        <td>OutOfMemoryError, StackOverflowError</td>
      </tr>
      <tr>
        <td>Checked Exception</td>
        <td>Bắt buộc try-catch hoặc throws</td>
        <td>IOException, SQLException</td>
      </tr>
      <tr>
        <td>Unchecked (Runtime)</td>
        <td>Không bắt buộc</td>
        <td>NullPointerException, IllegalArgumentException</td>
      </tr>
    </tbody>
  </table>
</section>

      </article>
    </main>
  </div>
  <footer class="topic-footer">
    <p>Xây dựng bằng Java 17+ · Không dùng framework · Pure NIO</p>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@9/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      securityLevel: 'loose',
      theme: 'base',
      flowchart: { useMaxWidth: true, htmlLabels: true, curve: 'basis', padding: 20 },
      themeVariables: {
        primaryColor: '#FFFFFF',
        primaryTextColor: '#0F172A',
        primaryBorderColor: '#10B981',
        secondaryColor: '#ECFDF5',
        secondaryBorderColor: '#059669',
        tertiaryColor: '#F8FAFC',
        tertiaryBorderColor: '#10B981',
        lineColor: '#64748B',
        textColor: '#334155',
        fontFamily: 'Inter, system-ui, sans-serif',
        fontSize: '14px',
        clusterBkg: '#F8FAFC',
        clusterBorder: '#10B981',
        titleColor: '#0F172A',
        nodeBorder: '#10B981',
        defaultLinkColor: '#64748B',
        edgeLabelBackground: '#ECFDF5',
        edgeLabelColor: '#047857',
        mainBkg: '#FFFFFF',
        secondBkg: '#ECFDF5'
      }
    });
    window.addEventListener('load', function() {
      var tooltipEl = document.createElement('div');
      tooltipEl.className = 'flow-tooltip';
      tooltipEl.innerHTML = '<div class="flow-tooltip__title"></div><div class="flow-tooltip__body"></div>';
      document.body.appendChild(tooltipEl);
      function getNodeIdFromElement(el) {
        if (!el) return null;
        var dataId = el.getAttribute && el.getAttribute('data-id');
        if (dataId) return dataId;
        var id = el.id;
        if (!id) return null;
        if (id.indexOf('flowchart-') === 0) {
          var rest = id.slice(10);
          var dash = rest.indexOf('-');
          return dash >= 0 ? rest.slice(0, dash) : rest;
        }
        return id;
      }
      function findClosest(el, sel) {
        if (!el || !el.nodeType) return null;
        if (el.closest) return el.closest(sel);
        while (el && el !== document) {
          if (el.matches && el.matches(sel)) return el;
          el = el.parentElement;
        }
        return null;
      }
      document.addEventListener('mouseover', function(e) {
        var t = e.target;
        var g = findClosest(t, 'g.node') || findClosest(t, 'g[id^="flowchart-"]');
        var diagram = g && findClosest(g, '.flow-diagram');
        if (!g || !diagram) return;
        if (!diagram) return;
        var script = diagram.querySelector('script[type="application/json"][data-flow-tooltips]');
        if (!script) return;
        var data;
        try { data = JSON.parse(script.textContent); } catch (err) { return; }
        var nodeId = getNodeIdFromElement(g);
        if (!nodeId) return;
        var tip = data[nodeId];
        if (!tip || !tip.detail) return;
        tooltipEl.querySelector('.flow-tooltip__title').textContent = tip.title || nodeId;
        tooltipEl.querySelector('.flow-tooltip__body').innerHTML = tip.detail;
        tooltipEl.style.left = '';
        tooltipEl.style.top = '';
        tooltipEl.classList.add('is-visible');
        var rect = g.getBoundingClientRect();
        var x = rect.left + rect.width / 2;
        var y = rect.top - 10;
        requestAnimationFrame(function() {
          var w = tooltipEl.offsetWidth;
          var h = tooltipEl.offsetHeight;
          tooltipEl.style.left = Math.max(12, Math.min(x - w / 2, window.innerWidth - w - 12)) + 'px';
          tooltipEl.style.top = Math.max(12, y - h) + 'px';
        });
      });
      document.addEventListener('mouseout', function(e) {
        var related = e.relatedTarget;
        if (related && findClosest(related, '.flow-diagram g.node')) return;
        tooltipEl.classList.remove('is-visible');
      });
      function styleRects() {
        document.querySelectorAll('.flow-diagram svg rect').forEach(function(r) {
          r.setAttribute('rx', '8');
          r.setAttribute('ry', '8');
          r.style.pointerEvents = 'auto';
        });
        document.querySelectorAll('.flow-diagram svg g.node').forEach(function(n) {
          n.style.pointerEvents = 'auto';
        });
      }
      [0, 150, 400, 800, 1500, 2500].forEach(function(d) { setTimeout(styleRects, d); });
    });
  </script>
</body>
</html>
