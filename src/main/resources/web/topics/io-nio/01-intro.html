<h2>I/O &amp; NIO — Đọc ghi dữ liệu</h2>

<p>Java cung cấp hai mô hình I/O: <strong>java.io</strong> (Stream-based, blocking) và <strong>java.nio</strong> (Buffer/Channel-based, hỗ trợ non-blocking). I/O cũ dùng stream byte/char; NIO dùng buffer và channel, phù hợp high-throughput và multiplexing.</p>

<section>
  <h3>Tổng quan từng phần</h3>
  <p>Mỗi phần gồm: <strong>Kỹ thuật</strong> (định nghĩa, API) và <strong>Ví dụ</strong> (code minh họa).</p>
  <table class="comparison-table">
    <caption>I/O &amp; NIO — Kỹ thuật và Ví dụ</caption>
    <thead>
      <tr>
        <th>Phần</th>
        <th>Kỹ thuật</th>
        <th>Ví dụ</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>01 — Intro</strong></td>
        <td>Stream vs Buffer/Channel, blocking vs non-blocking</td>
        <td>InputStream hierarchy, use case</td>
      </tr>
      <tr>
        <td><strong>02 — Stream</strong></td>
        <td>InputStream/OutputStream, Reader/Writer</td>
        <td>FileInputStream, BufferedReader</td>
      </tr>
      <tr>
        <td><strong>03 — File</strong></td>
        <td>File API, đọc ghi file</td>
        <td>FileReader, BufferedInputStream</td>
      </tr>
      <tr>
        <td><strong>04 — NIO Buffer</strong></td>
        <td>ByteBuffer, position, limit, flip</td>
        <td>allocate, put, get</td>
      </tr>
      <tr>
        <td><strong>05 — NIO Channel</strong></td>
        <td>FileChannel, transferTo, SocketChannel</td>
        <td>Copy file, scatter/gather</td>
      </tr>
      <tr>
        <td><strong>06 — Path &amp; Files</strong></td>
        <td>Path, Files API, NIO.2</td>
        <td>Files.readAllLines, walk</td>
      </tr>
      <tr>
        <td><strong>07 — Selector</strong></td>
        <td>Multiplexing, non-blocking server</td>
        <td>SelectableChannel, select()</td>
      </tr>
    </tbody>
  </table>
</section>

<section>
  <h3>Lộ trình học — Sơ đồ flow</h3>
  <p>Sơ đồ dưới đây thể hiện thứ tự học và mối liên hệ giữa các phần. Mỗi ô là một phần; mũi tên chỉ hướng tiếp theo.</p>

  <div class="flow-diagram">
    <script type="application/json" data-flow-tooltips>
    {"F1":{"title":"01 Intro - io vs nio","detail":"<p><strong>java.io</strong> - Stream, đọc/ghi byte hoặc char tuần tự. Blocking - thread chờ I/O xong.</p><p><strong>java.nio</strong> - Buffer + Channel. Hỗ trợ non-blocking, Selector multiplexing. Dùng cho file đơn giản: io. Server nhiều kết nối: nio.</p>"},"F2":{"title":"02 Stream","detail":"<p><strong>InputStream/OutputStream</strong> - byte. Reader/Writer - char. BufferedInputStream giảm system call.</p><p>InputStreamReader(stream, Charset) - chuyển byte sang char với encoding. DataInputStream cho primitive.</p>"},"F3":{"title":"03 File","detail":"<p>FileInputStream, FileReader. BufferedReader.readLine() cho text. Luôn dùng try-with-resources.</p><p>Pattern: mở stream -&gt; đọc/ghi loop -&gt; đóng. Buffered cho performance.</p>"},"F4":{"title":"04 NIO Buffer","detail":"<p><strong>ByteBuffer</strong> - position, limit, capacity. put() tăng position. flip() chuyển write mode sang read (limit=position, position=0).</p><p>clear() reset. compact() đẩy unread lên đầu. Direct buffer - ngoài heap, zero-copy với I/O.</p>"},"F5":{"title":"05 NIO Channel","detail":"<p>FileChannel - read(ByteBuffer), write(ByteBuffer). transferTo() copy file hiệu quả (zero-copy khi có thể).</p><p>SocketChannel cho network. Scatter/gather - nhiều buffer một lần.</p>"},"F6":{"title":"06 Path &amp; Files","detail":"<p><strong>Path</strong> thay File. Paths.get(). Files.readAllBytes(), readAllLines(), write().</p><p>Files.walk() duyệt cây thư mục. FileVisitor cho custom logic.</p>"},"F7":{"title":"07 Selector","detail":"<p><strong>Multiplexing</strong> - một thread theo dõi nhiều Channel. SelectableChannel.configureBlocking(false), register(selector, ops).</p><p>select() block đến khi có channel sẵn sàng. selectedKeys() - channel có event. Dùng cho server socket nhiều client.</p>"}}
    </script>
    <pre class="mermaid">
flowchart TD
  subgraph JavaIO ["java.io - Stream"]
    direction LR
    F1("01 Intro")
    F2("02 Stream")
    F3("03 File")
    F1 -->|"Blocking"| F2 -->|"InputStream, Reader"| F3
  end
  subgraph JavaNIO ["java.nio - Buffer and Channel"]
    direction LR
    F4("04 Buffer")
    F5("05 Channel")
    F6("06 Path and Files")
    F4 -->|"ByteBuffer, flip"| F5 -->|"FileChannel"| F6
  end
  subgraph Advanced [Advanced]
    F7("07 Selector")
  end
  JavaIO -->|"BufferedReader"| JavaNIO
  JavaNIO -->|"Multiplexing"| Advanced
    </pre>
  </div>

  <table class="comparison-table">
    <caption>Chú thích từng phần</caption>
    <thead>
      <tr><th>Phần</th><th>Nội dung chính</th></tr>
    </thead>
    <tbody>
      <tr><td>01</td><td>Stream vs Buffer/Channel, blocking vs non-blocking</td></tr>
      <tr><td>02</td><td>InputStream, OutputStream, Reader, Writer</td></tr>
      <tr><td>03</td><td>File API, FileInputStream, BufferedInputStream</td></tr>
      <tr><td>04</td><td>ByteBuffer, position, limit, flip</td></tr>
      <tr><td>05</td><td>FileChannel, transferTo, SocketChannel</td></tr>
      <tr><td>06</td><td>Path, Files.readAllLines, walk</td></tr>
      <tr><td>07</td><td>Selector, non-blocking, multiplexing</td></tr>
    </tbody>
  </table>
</section>

<section>
  <h3>Tổng quan I/O vs NIO</h3>
  <h4>Kỹ thuật</h4>
  <table class="comparison-table">
    <caption>So sánh java.io và java.nio</caption>
    <thead>
      <tr>
        <th>Tiêu chí</th>
        <th>java.io (Stream)</th>
        <th>java.nio (Buffer/Channel)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Mô hình</td>
        <td>Stream — đọc/ghi tuần tự</td>
        <td>Buffer + Channel — đọc/ghi qua buffer</td>
      </tr>
      <tr>
        <td>Blocking</td>
        <td>Blocking (thread chờ I/O)</td>
        <td>Hỗ trợ non-blocking (Selector)</td>
      </tr>
      <tr>
        <td>Đơn vị xử lý</td>
        <td>Byte/char</td>
        <td>Block (Buffer)</td>
      </tr>
      <tr>
        <td>Multiplexing</td>
        <td>Không</td>
        <td>Selector — 1 thread quản lý nhiều channel</td>
      </tr>
      <tr>
        <td>Package</td>
        <td><code>java.io</code></td>
        <td><code>java.nio</code>, <code>java.nio.channels</code>, <code>java.nio.file</code></td>
      </tr>
    </tbody>
  </table>

  <h4>Ví dụ — Luồng dữ liệu</h4>
  <pre><code>// java.io — Stream
Source → InputStream/Reader → [process] → OutputStream/Writer → Destination

// java.nio — Buffer + Channel
Source → Channel.read(ByteBuffer) → Buffer → [process] → Buffer → Channel.write(ByteBuffer) → Destination</code></pre>
</section>

<section>
  <h3>Hierarchy java.io</h3>
  <p><strong>InputStream / OutputStream</strong> — byte stream. <strong>Reader / Writer</strong> — character stream (Unicode). Các subclass: FileInputStream, BufferedInputStream, FileReader, BufferedReader... Luôn đóng stream bằng try-with-resources để tránh rò rỉ file descriptor.</p>

  <h4>Sơ đồ phân cấp</h4>
  <pre><code>InputStream
  ├── FileInputStream
  ├── ByteArrayInputStream
  ├── FilterInputStream
  │     ├── BufferedInputStream
  │     ├── DataInputStream
  │     └── GZIPInputStream (via InflaterInputStream)
  └── ObjectInputStream

Reader
  ├── FileReader
  ├── InputStreamReader  ← bridge byte → char (encoding)
  └── BufferedReader</code></pre>

  <h4>Hierarchy java.nio</h4>
  <p><strong>Buffer</strong> — ByteBuffer, CharBuffer, IntBuffer... Container cho dữ liệu. <strong>Channel</strong> — FileChannel, SocketChannel, ServerSocketChannel... Kết nối tới nguồn/đích. <strong>Selector</strong> — multiplexing nhiều channel non-blocking.</p>

  <pre><code>Buffer (ByteBuffer, CharBuffer...)
Channel
  ├── FileChannel
  ├── SocketChannel
  ├── ServerSocketChannel
  └── DatagramChannel

Selector — quản lý nhiều SelectableChannel</code></pre>

  <h4>Use case — Khi nào dùng gì</h4>
  <table class="comparison-table">
    <thead>
      <tr>
        <th>Use case</th>
        <th>Gợi ý</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Đọc file text nhỏ</td>
        <td>Files.readAllLines() hoặc BufferedReader</td>
      </tr>
      <tr>
        <td>Đọc file binary</td>
        <td>BufferedInputStream + FileInputStream</td>
      </tr>
      <tr>
        <td>Copy file lớn</td>
        <td>FileChannel.transferTo()</td>
      </tr>
      <tr>
        <td>Server nhiều kết nối</td>
        <td>Selector + SocketChannel</td>
      </tr>
      <tr>
        <td>Duyệt thư mục</td>
        <td>Files.walk() hoặc FileVisitor</td>
      </tr>
    </tbody>
  </table>

  <section class="when-use">
    <h4>Khi nào dùng I/O vs NIO?</h4>
    <p class="when-use-do"><strong>java.io:</strong> File đơn giản, text đọc/ghi; dùng Reader/Writer cho encoding; code đơn giản, dễ hiểu.</p>
    <p class="when-use-avoid"><strong>java.nio:</strong> Tránh khi chỉ cần đọc file nhỏ; ưu tiên khi cần high-throughput, non-blocking, multiplexing (server nhiều kết nối).</p>
  </section>
</section>
